# @Author liyongjie
# Windows 桌面构建工作流

name: Build Windows

on:
  workflow_call:
    inputs:
      upload-artifacts:
        type: boolean
        default: true
    secrets:
      TAURI_PRIVATE_KEY:
        required: false
      TAURI_KEY_PASSWORD:
        required: false

jobs:
  build:
    name: Windows x86_64
    runs-on: windows-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Build Environment
        uses: ./.github/actions/setup-build-env
        with:
          rust-targets: x86_64-pc-windows-msvc

      - name: Build Frontend
        working-directory: packages/cold-wallet
        run: pnpm build

      - name: Build Tauri App
        working-directory: packages/cold-wallet
        env:
          TAURI_PRIVATE_KEY: ${{ secrets.TAURI_PRIVATE_KEY }}
          TAURI_KEY_PASSWORD: ${{ secrets.TAURI_KEY_PASSWORD }}
        run: pnpm tauri build --target x86_64-pc-windows-msvc

      - name: Upload Artifacts
        if: inputs.upload-artifacts
        uses: actions/upload-artifact@v4
        with:
          name: cold-wallet-windows-x64
          path: |
            packages/cold-wallet/src-tauri/target/x86_64-pc-windows-msvc/release/bundle/msi/*.msi
            packages/cold-wallet/src-tauri/target/x86_64-pc-windows-msvc/release/bundle/nsis/*.exe
          retention-days: 7

